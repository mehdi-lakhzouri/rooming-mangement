# Guide de Déploiement - Rooming Management App

## Vue d'ensemble
Ce guide détaille les étapes pour déployer l'application Rooming Management :
- **Frontend** : Next.js déployé sur Vercel
- **Backend** : NestJS avec Prisma déployé sur Railway (recommandé)

---

## 1. Préparation du Frontend (Vercel)

### Étape 1.1 : Configuration Vercel
```bash
# Installer Vercel CLI (si pas déjà fait)
npm install -g vercel

# Se connecter à Vercel
vercel login
```

### Étape 1.2 : Préparer le frontend
```bash
cd frontend

# Créer un fichier vercel.json pour la configuration
# (sera créé automatiquement si nécessaire)

# Build de production
npm run build
```

### Étape 1.3 : Variables d'environnement pour Vercel
Dans le dashboard Vercel ou via CLI :
```
NEXT_PUBLIC_API_URL=https://votre-backend-url.railway.app
```

### Étape 1.4 : Déploiement
```bash
# Depuis le dossier frontend
vercel --prod

# Ou via le dashboard Vercel :
# 1. Aller sur vercel.com
# 2. Importer le repo GitHub
# 3. Sélectionner le dossier "frontend"
# 4. Configurer les variables d'environnement
# 5. Déployer
```

---

## 2. Préparation du Backend (Railway)

### Étape 2.1 : Créer un compte Railway
- Aller sur https://railway.app
- Se connecter avec GitHub

### Étape 2.2 : Préparer le backend pour le déploiement
```bash
cd backend

# Créer un fichier railway.json
{
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "startCommand": "npm run start:prod"
  }
}

# Créer un script de démarrage pour Railway
# Ajouter dans package.json :
"scripts": {
  "start:prod": "node dist/main"
}
```

### Étape 2.3 : Variables d'environnement pour Railway
```
DATABASE_URL=postgresql://... (votre URL Supabase)
DIRECT_URL=postgresql://... (votre URL Supabase directe)
PORT=3001
FRONTEND_URL=https://votre-frontend-url.vercel.app
SHEET_CODE_PREFIX=SDC
```

### Étape 2.4 : Configuration Prisma pour Railway
```bash
# Générer le client Prisma
npx prisma generate

# Pour Railway, utiliser le build command suivant :
# Dans railway.json ou dashboard :
buildCommand: "npm run build && npx prisma generate && npx prisma migrate deploy"
```

### Étape 2.5 : Déploiement sur Railway
```bash
# Via Railway CLI (optionnel)
npm install -g @railway/cli
railway login
railway link
railway up

# Ou via le dashboard :
# 1. Créer un nouveau projet
# 2. Connecter le repo GitHub
# 3. Sélectionner le dossier "backend"
# 4. Configurer les variables d'environnement
# 5. Déployer
```

---

## 3. Configuration CORS

### Étape 3.1 : Mettre à jour le backend pour accepter Vercel
Dans `main.ts` :
```typescript
app.enableCors({
  origin: process.env.FRONTEND_URL || 'http://localhost:3000',
  credentials: true,
});
```

---

## 4. Configuration de la Base de Données

### Étape 4.1 : Utiliser Supabase (recommandé)
- Votre base Supabase est déjà configurée
- Assurez-vous que les URLs sont correctes dans les variables d'environnement

### Étape 4.2 : Migration de la base de données
```bash
# Appliquer les migrations sur Supabase
npx prisma migrate deploy
```

---

## 5. Vérifications Post-Déploiement

### Étape 5.1 : Tester les endpoints API
```bash
# Tester la connexion à l'API
curl https://votre-backend-url.railway.app/

# Tester les routes principales
curl https://votre-backend-url.railway.app/rooms
curl https://votre-backend-url.railway.app/sheets
```

### Étape 5.2 : Vérifier le frontend
- Accéder à l'URL Vercel
- Tester la création de salles
- Vérifier la connexion WebSocket

---

## 6. Dépannage

### Problèmes courants :

1. **Erreur de connexion à la base de données**
   - Vérifier les URLs Supabase
   - S'assurer que les credentials sont corrects

2. **Erreur CORS**
   - Vérifier FRONTEND_URL dans les variables d'environnement
   - S'assurer que CORS est configuré dans main.ts

3. **Erreur Prisma**
   - Régénérer le client : `npx prisma generate`
   - Appliquer les migrations : `npx prisma migrate deploy`

4. **Erreur de build**
   - Vérifier les dépendances : `npm install`
   - Vérifier TypeScript : `npm run build`

---

## 7. Commandes Utiles

```bash
# Frontend
cd frontend
npm install
npm run build
npm run start

# Backend
cd backend
npm install
npm run build
npm run start:prod

# Base de données
npx prisma generate
npx prisma migrate deploy
npx prisma studio
```

---

## 8. URLs Importantes

- **Frontend (Vercel)** : https://votre-app.vercel.app
- **Backend (Railway)** : https://votre-backend.railway.app
- **Base de données (Supabase)** : https://supabase.com/dashboard/project/votre-project

---

## 9. Monitoring et Maintenance

- **Logs** : Vérifier les logs dans Railway et Vercel dashboards
- **Métriques** : Monitorer l'usage via les dashboards des services
- **Sauvegardes** : Supabase gère automatiquement les sauvegardes

---

*Dernière mise à jour : 5 novembre 2025*</content>
<parameter name="filePath">DEPLOYMENT_GUIDE.txt